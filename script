--[[
    ROBLOX R6 MOBİL EMOTE: "GEL BURAYA" (TOGGLE VERSİYON)
    Yapımcı: Gemini & Kanka
    Özellik: Tek Tıkla Aç/Kapa
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Karakter Değişkenleri
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Torso = Character:WaitForChild("Torso")
local RightShoulder = Torso:WaitForChild("Right Shoulder")

-- Orijinal pozisyonu sakla
local OriginalC0 = RightShoulder.C0
local IsPlaying = false -- Açık mı kapalı mı kontrolü

-- --- GUI OLUŞTURMA ---
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ToggleEmoteGUI"
ScreenGui.Parent = game.CoreGui

local EmoteBtn = Instance.new("TextButton")
EmoteBtn.Name = "ToggleBtn"
EmoteBtn.Size = UDim2.new(0, 60, 0, 60)
EmoteBtn.Position = UDim2.new(0.8, 0, 0.5, 0) -- Ekranın sağ ortası
EmoteBtn.BackgroundColor3 = Color3.fromRGB(255, 85, 0) -- Turuncu (Kapalı Rengi)
EmoteBtn.Text = "OFF"
EmoteBtn.TextSize = 20
EmoteBtn.TextColor3 = Color3.new(1,1,1)
EmoteBtn.Font = Enum.Font.FredokaOne
EmoteBtn.BorderSizePixel = 0
EmoteBtn.Active = true
EmoteBtn.Draggable = true -- Sürüklenebilir
EmoteBtn.Parent = ScreenGui

-- Yuvarlak Görünüm
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(1, 0)
UICorner.Parent = EmoteBtn

-- --- ANİMASYON FONKSİYONU ---
local function StartAnimationLoop()
    local startTime = tick()
    local connection
    
    connection = RunService.RenderStepped:Connect(function()
        -- Eğer karakter yenilendiyse veya script durdurulduysa
        if not Character or not RightShoulder then 
            connection:Disconnect()
            return
        end

        if IsPlaying then
            -- === ANİMASYON AKTİF ===
            local currentTime = tick() - startTime
            
            -- Kolu kaldır ve salla
            local baseCFrame = CFrame.new(1, 0.5, 0) * CFrame.Angles(0, math.rad(90), 0)
            local wave = math.sin(currentTime * 8) * 0.6 -- Hız 8
            local targetCFrame = baseCFrame * CFrame.Angles(0, 0, wave + 0.5) 

            -- Yumuşak geçişle hareketi yap
            RightShoulder.C0 = RightShoulder.C0:Lerp(targetCFrame, 0.2)
            
        else
            -- === ANİMASYON KAPANIYOR ===
            -- Yavaşça eski haline dön
            RightShoulder.C0 = RightShoulder.C0:Lerp(OriginalC0, 0.1)
            
            -- Eski haline çok yaklaştıysa döngüyü bitir (Performans için)
            if (RightShoulder.C0.Position - OriginalC0.Position).Magnitude < 0.01 then
                RightShoulder.C0 = OriginalC0
                connection:Disconnect()
            end
        end
    end)
end

-- --- BUTON TIKLAMA OLAYI ---
EmoteBtn.MouseButton1Click:Connect(function()
    IsPlaying = not IsPlaying -- Durumu tersine çevir (Açıksa kapat, kapalıysa aç)

    if IsPlaying then
        -- AÇILDI
        EmoteBtn.Text = "ON"
        EmoteBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0) -- Yeşil
        StartAnimationLoop() -- Döngüyü başlat
    else
        -- KAPANDI
        EmoteBtn.Text = "OFF"
        EmoteBtn.BackgroundColor3 = Color3.fromRGB(255, 85, 0) -- Turuncu
        -- Döngü zaten "else" kısmında kendini durduracak
    end
end)

-- --- KARAKTER ÖLÜRSE YENİLE ---
LocalPlayer.CharacterAdded:Connect(function(newChar)
    Character = newChar
    if Character:FindFirstChild("Torso") then
        Torso = Character:WaitForChild("Torso")
        RightShoulder = Torso:WaitForChild("Right Shoulder")
        OriginalC0 = RightShoulder.C0
        
        -- Ölünce butonu sıfırla
        IsPlaying = false
        EmoteBtn.Text = "OFF"
        EmoteBtn.BackgroundColor3 = Color3.fromRGB(255, 85, 0)
    end
end)
